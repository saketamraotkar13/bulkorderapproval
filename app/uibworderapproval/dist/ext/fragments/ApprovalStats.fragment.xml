<core:FragmentDefinition
	xmlns="sap.m"
	xmlns:core="sap.ui.core"
	xmlns:mvc="sap.ui.core.mvc"
	xmlns:layout="sap.ui.layout"
	xmlns:viz="sap.viz.ui5.controls"
	xmlns:viz.feeds="sap.viz.ui5.controls.common.feeds"
	xmlns:viz.data="sap.viz.ui5.data">
	<Dialog
		id="ShowTablePop"
		title="ðŸ“Š Order Approval KPIs"
		contentWidth="100%"
		contentHeight="100%"
		draggable="true"
		resizable="true"
		core:require="{handler: 'uibworderapproval/ext/controller/OrderList'}">
		<content>
			<layout:VerticalLayout class="sapUiContentPadding" width="100%">
				<!-- Large Donut Chart with Count -->
				<layout:VerticalLayout width="50%" class="sapUiSmallMarginTop">
					<Title text="Order Status Distribution" level="H4" class="sapUiSmallMarginBottom"/>
					<viz:VizFrame
						id="donutChart"
						uiConfig="{applicationSet:'fiori'}"
						height="230px"
						width="100%"
						vizType="donut"
						vizProperties="{
							title: {
								visible: false
							},
							plotArea: {
								dataLabel: {
									visible: true,
									type: 'value',
									formatString: '#,##0'
								},
								innerRadius: 0.8
							},
							legend: {
								visible: true,
								position: 'right'
							}
						}">
						<viz:dataset>
							<viz.data:FlattenedDataset data="{kpi>/chartData}">
								<viz.data:dimensions>
									<viz.data:DimensionDefinition name="Status" value="{kpi>status}"/>
								</viz.data:dimensions>
								<viz.data:measures>
									<viz.data:MeasureDefinition name="Count" value="{kpi>count}"/>
								</viz.data:measures>
							</viz.data:FlattenedDataset>
						</viz:dataset>
						<viz:feeds>
							<viz.feeds:FeedItem uid="size" type="Measure" values="Count"/>
							<viz.feeds:FeedItem uid="color" type="Dimension" values="Status"/>
						</viz:feeds>
					</viz:VizFrame>
					<!-- <Label text="KPI Details:"></Label> -->
				</layout:VerticalLayout>
				<!-- Statistics Table -->
				<Table class="sapUiSmallMarginTop" width="100%"> 
					<columns>
						<Column width="50%">
							<header>
								<Label text="Metric"/>
							</header>
						</Column>
						<Column width="25%" hAlign="End">
							<header>
								<Label text="Count"/>
							</header>
						</Column>
						<Column width="25%" hAlign="End">
							<header>
								<Label text="Percentage"/>
							</header>
						</Column>
					</columns>
					<items>
						<ColumnListItem>
							<cells>
								<Text text="Total Orders"/>
								<ObjectNumber number="{kpi>/totalOrders}" state="None"/>
								<Text text="100.00%"/>
							</cells>
						</ColumnListItem>
						<ColumnListItem>
							<cells>
								<Text text="Approved Orders"/>
								<ObjectNumber number="{kpi>/approvedOrders}" state="Success"/>
								<Text text="{kpi>/approvalRate}%"/>
							</cells>
						</ColumnListItem>
						<ColumnListItem>
							<cells>
								<Text text="Rejected Orders"/>
								<ObjectNumber number="{kpi>/rejectedOrders}" state="Error"/>
								<Text text="{kpi>/rejectionRate}%"/>
							</cells>
						</ColumnListItem>
						<ColumnListItem>
							<cells>
								<Text text="Pending Orders"/>
								<ObjectNumber number="{kpi>/pendingOrders}" state="Warning"/>
								<Text text="{kpi>/pendingRate}%"/>
							</cells>
						</ColumnListItem>
						<ColumnListItem vAlign="Middle">
							<cells>
								<ObjectIdentifier title="Other Metcics"/>
							</cells>
						</ColumnListItem>
						<!-- âœ… NEW: Total Quantity Row -->
						<ColumnListItem>
							<cells>
								<Text text="Total Quantity"/>
								<Text text="{kpi>/sumOfQuantity}"/>
							</cells>
						</ColumnListItem>
						<!-- âœ… NEW: Total Profit At Risk Row -->
						<ColumnListItem>
							<cells>
								<Text text="Total Profit At Risk"/>
								<Text text="{kpi>/sumOfProfitAtRisk}"/>
							</cells>
						</ColumnListItem>
					</items>
				</Table>
			</layout:VerticalLayout>
		</content>
		<endButton>
			<Button text="Close" press="handler.onCloseTableDialog"/>
		</endButton>
	</Dialog>
</core:FragmentDefinition>