sap.ui.define(["sap/m/MessageToast","sap/m/MessageBox","sap/ui/core/Fragment"],function(e,t,a){"use strict";return{onShowKPIs:function(r,o){e.show("Loading KPI Dashboard...");var s=this.getModel();var n=this;sap.ui.core.BusyIndicator.show(0);var i=s.bindContext("/getApprovalStats(...)");i.execute().then(function(){var e=i.getBoundContext().getObject();console.log("ðŸ“Š KPI Data received:",e);sap.ui.core.BusyIndicator.hide();if(!n._kpiDialog){a.load({id:"kpiFragment",name:"uibworderapproval.ext.fragments.ApprovalStats",controller:n}).then(function(t){n._kpiDialog=t;var a=new sap.ui.model.json.JSONModel({totalOrders:e.totalOrders||0,approvedOrders:e.approvedOrders||0,rejectedOrders:e.rejectedOrders||0,pendingOrders:e.pendingOrders||0,approvalRate:e.approvalRate||0,rejectionRate:e.rejectionRate||0,pendingRate:e.pendingRate||0,sumOfQuantity:e.sumOfQuantity||0,lastUpdated:(new Date).toLocaleString(),chartData:[{status:"Approved",count:e.approvedOrders||0},{status:"Rejected",count:e.rejectedOrders||0},{status:"Pending",count:e.pendingOrders||0}]});n._kpiDialog.setModel(a,"kpi");n._kpiDialog.open();console.log("âœ… Dialog opened with KPI data")}).catch(function(e){console.error("âŒ Error loading fragment:",e);t.error("Failed to load fragment: "+e.message)})}else{var r=n._kpiDialog.getModel("kpi");r.setData({totalOrders:e.totalOrders||0,approvedOrders:e.approvedOrders||0,rejectedOrders:e.rejectedOrders||0,pendingOrders:e.pendingOrders||0,approvalRate:e.approvalRate||0,rejectionRate:e.rejectionRate||0,pendingRate:e.pendingRate||0,sumOfQuantity:e.sumOfQuantity||0,lastUpdated:(new Date).toLocaleString(),chartData:[{status:"Approved",count:e.approvedOrders||0},{status:"Rejected",count:e.rejectedOrders||0},{status:"Pending",count:e.pendingOrders||0}]});n._kpiDialog.open();console.log("âœ… Dialog reopened with refreshed data")}}).catch(function(e){sap.ui.core.BusyIndicator.hide();console.error("âŒ Failed to load KPI data:",e);t.error("Failed to load KPI statistics: "+(e.message||"Unknown error"))})},onCloseTableDialog:function(){if(this._kpiDialog){this._kpiDialog.close()}},onBulkApproval:async function(e,t){if(!t||t.length===0){sap.m.MessageBox.warning("Please select at least one order.");return}const a=t[0].getModel();const r=t.map(e=>e.getObject());const o=r.map(e=>({orderNumber:e.orderNumber,itemNumber:e.itemNumber}));const s=r.length;const n=function(e){let t=[];if(!e)return t;if(e.aFilters&&e.aFilters.length>0){e.aFilters.forEach(e=>{t=t.concat(n(e))})}else if(e.sPath){t.push({path:e.sPath,operator:e.sOperator,value1:e.oValue1,value2:e.oValue2})}return t};const i=this.getFilters();let d=[];if(i.filters&&i.filters.length>0){d=n(i.filters[0])}var l=new sap.m.CheckBox({text:"Approve Load",width:"100%",selected:true});var p=new sap.m.ComboBox({width:"100%",placeholder:"Select Reason Code...",enabled:!l.getSelected(),required:!l.getSelected(),items:{path:"/reasonCodeVH",template:new sap.ui.core.ListItem({key:"{reasonCode}",text:"{reasonCode} - {description}"})}});l.attachSelect(function(e){var t=e.getParameter("selected");p.setEnabled(!t);p.setRequired(!t);if(t){p.setSelectedKey("")}});var c=new sap.m.CheckBox({text:"Apply on all filtered orders",design:"Bold",width:"90%",selected:false});var u=new sap.m.Label({text:"Selected Orders: "+s,width:"100%",visible:!c.getSelected()});c.attachSelect(function(e){u.setVisible(!e.getParameter("selected"))});var g=new sap.m.VBox({width:"100%",items:[l,new sap.m.Label({text:"Reason Code",design:"Bold"}),p,u,c],class:"sapUiSmallMargin sapUiMediumPadding"});var m=new sap.m.Dialog({title:"Bulk Approval",contentWidth:"400px",type:"Message",content:[g],beginButton:new sap.m.Button({text:"Confirm",type:"Emphasized",press:async function(){var e=l.getSelected();var t=p.getSelectedKey();var r=c.getSelected();if(!e&&!t){sap.m.MessageBox.warning("Reason Code is required when rejecting the order.");return}try{function n(e,t){const a=[];for(let r=0;r<e.length;r+=t){a.push(e.slice(r,r+t))}return a}const i=n(o,200);for(const u of i){var s=a.bindContext("/approveOrders(...)");s.setParameter("orders",u);s.setParameter("approveLoad",e);s.setParameter("reasonCode",e?"":t);s.setParameter("filters",JSON.stringify(d));s.setParameter("allSelected",r);await s.execute()}sap.m.MessageToast.show("Orders processed successfully.");a.refresh()}catch(g){console.error("Bulk approval failed:",g);sap.m.MessageBox.error("Bulk approval failed: "+(g.message||"Unknown error"))}finally{m.close()}}}),endButton:new sap.m.Button({text:"Cancel",press:function(){m.close()}}),afterClose:function(){m.destroy()}});m.setModel(a);m.addStyleClass("sapUiContentPadding sapUiSizeCompact");m.open()}}});
//# sourceMappingURL=OrderList.js.map